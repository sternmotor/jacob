<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <!-- Generator: Notebooks for Mac 1.1.2 -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <title>New Note</title>
<!-- Notebooks Default Theme 1.3.2 -->
<style type="text/css">

body { 
	font-family: Source Sans Pro; 
	color: #000000; 
	font-size: 15px; 
	line-height: **NotebooksLinespacing**;
	background-color: #ffffff;
	background-image:url('**NotebooksBGImage**');
	padding: 5%;
	-webkit-hyphens: auto;
	margin: 0.0px 0.0px 0.0px 0.0px;
	-webkit-text-size-adjust: none;
}

p.head { 
	font-size: 1.4em; 
	line-height: 1.5em; 
	text-align: left; 
	font-weight: normal; 
	margin: 0em 0px 1.25em 0px; 
}

img { 
	width:auto; 
	max-width:70%; 
	height:auto; 
	-webkit-border-radius: 1px; 
	border: none; 
	padding: 12px !important; 
	background-color: #fff; 
	text-align: center; 
	overflow: hidden; 
	-webkit-box-shadow: 0 1px 3px #9e9c93; 
}

table { 
	border: 1px solid gray;  
	-webkit-border-radius: 3px; 
	padding: 6px !important; 
	-webkit-box-shadow: 0 1px 3px #9e9c93; 
	margin-left: auto; 
	margin-right: auto; 
}

table th { 
	padding-left: 30px; 
	padding-right: 30px; 
	vertical-align:top; 
}

table td { 
	padding-left: 30px; 
	padding-right: 30px;
	vertical-align:top; 
}

hr { 
	height: 1px; 
	margin: 2em 0em 4em 0;
	text-align: center; 
	background-color: #ddd;
	border-width: 0; 
}

h1 { 
	font-size: 1.4em; 
	text-align: left; 
	font-weight: normal; 
	line-height: 1.5em; 
	margin: 0em 0px 1.25em 0px; 
}

h2 { 
	font-size: 1.1em; 
	text-align: left; 
	font-weight: normal; 
	line-height: 1.5em; 
	letter-spacing: .1em; 
	margin: 2.5em 0 1em 0; 
	text-transform: uppercase; 
	border-bottom:1px solid #ddd;
}

h1 + h2 {
	margin-top: 1.5em;
}

h3 { 
	font-size: .91em; 
	text-align: left; 
	font-weight: normal; 
	line-height: 1.5em; 
	letter-spacing: .1em; 
	margin: 2.0em 0 1em 0; 
	text-transform: uppercase; 
}

h2 + h3 {
	margin-top: 2.5em;
}

h4, h5, h6 { 
	font-size: 1em; 
	text-align: left; 
	font-weight: bold; 
	line-height: 1.5em; 
	margin: 2em 0 0 0; 
}

blockquote { 
	font-size: 1em; 
	margin: 2em 2em 2em 1em; 
	padding: 0 .75em 0 1.25em; 
	border-left: 1px solid #777; 
}

blockquote strong { 
	font-weight: bold; 
	font-size: 1em; 
	letter-spacing: normal; 
	text-transform: none; 
}

ul, ol { 
	padding-left: 1.25em; 
	margin-left: 1em; 
	text-indent:0em;
}

li {
	padding-top: 0.25em;
	padding-bottom: 0.25em;
}

pre { 
	line-height: 1.45em; 
	background-color: inherit; 
	margin: 2em 0 2.5em 0; 
	padding: 5px 0 5px 10px; 
	border-width: 1px 0 1px 0; 
	border-color: #6b6b6b; 
	border-style: dashed; 
	width: auto;
	white-space: pre-wrap;
}

code { 
	font-size: 0.91em;
}

dt { 
	font-size: 1em; 
	text-align: left; 
	font-weight: normal; 
	margin-top: 0.5em; 
	letter-spacing: normal; 
	text-transform: none; 
}

dd { 
	margin: auto auto 0 2.25em; 
}


@media print  {

  body {
	background: white;
	padding: 0%;
  }

  h1 { 
	page-break-before: always;
  }

  h1:first-of-type {
    page-break-before: avoid;
    counter-reset: page;
  }

  h1, h2, h3, h4, h5, h6 {
	page-break-after:avoid; 
	page-break-inside:avoid 
  }

  blockquote, table, pre { 
	page-break-inside:avoid 
  }

  ul, ol, dl  { 
	page-break-before:avoid 
  }

  img { 
	page-break-inside:avoid; 
	page-break-after:avoid;
  }
}

</style>
</head>
<body>
<div class="errormsg systemmsg" id="sessionMsg">
	<div class="inner">
		<ul class="flashMsg">
			<li>Diese Seite muss komplett üerbarbeitet werden, Vorlage: <a href="mks://localhost/Abteilungen/Entwicklung/Executive/Tools/Windows/Powershell/Administration" title="Abteilungen/Entwicklung/Executive/Tools/Windows/Powershell/Administration">Powershell&nbsp;Administration</a></li>
		</ul>
	</div>
</div>
<h2>Inhaltsverzeichnis</h2>
<p>{{ page.toc }}</p>
<h2>Einleitung</h2>
<p>CodeSchnipsel zur Administration von Servern mit Puppet</p>
<h2>Ubuntu</h2>
<h3>Paketinstallation</h3>
<h4>Klasse für das Installieren</h4>
<p>Wird benötigt, wenn externe APT Mirrors und Key einzubinden sind. Abhängigkeiten werden sauber aufgelöst. Siehe Hilfetext</p>
<pre>class zabbix::packages($enable=true, $packages) {
&nbsp;&nbsp;&nbsp; /*/////////////////////////////////////////////////////////////////////////
&nbsp;&nbsp;&nbsp; SYNOPSIS
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Install zabbix mirror, run apt-get update and keep packages
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * up-to-date

&nbsp;&nbsp;&nbsp; DESCRIPTION
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Meant for internal use in zabbix classes

&nbsp;&nbsp;&nbsp; EXAMPLE
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Invoke package installation/update and service restart like:
&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class {'zabbix::packages':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enable =&gt; true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; packages =&gt; ['zabbix-agent'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # enable service
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; service { 'zabbix-agent':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enable =&gt; $enable,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; stopped,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; running,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # restart service whenever package or config file changes
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subscribe =&gt; [
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Package['zabbix-agent'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File['/etc/zabbix/zabbix_agentd.conf'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; /////////////////////////////////////////////////////////////////////////*/

&nbsp;&nbsp;&nbsp; $zabbix_apt_mirror&nbsp; = "deb http://repo.zabbix.com/zabbix/2.4/ubuntu $lsbdistcodename main"
&nbsp;&nbsp;&nbsp; $zabbix_apt_file&nbsp;&nbsp;&nbsp; = 'zabbix.list'
&nbsp;&nbsp;&nbsp; $zabbix_apt_key_url = 'http://repo.zabbix.com/zabbix-official-repo.key'
&nbsp;&nbsp;&nbsp; # key id is take from "apt-key list" line like "pub&nbsp;&nbsp; 1024D/79EA5ED4 2012-10-28"
&nbsp;&nbsp;&nbsp; $zabbix_apt_key_id&nbsp; = '79EA5ED4'

&nbsp;&nbsp;&nbsp; package { $packages :
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; absent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; latest,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subscribe =&gt; Exec[ 'zabbix apt update' ],
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; exec { 'zabbix apt update':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; command =&gt; "/usr/bin/apt-get update",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # important: run only if necessary
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; refreshonly =&gt; true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subscribe =&gt; [
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File['zabbix apt sources list'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exec['zabbix apt repository key'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; file { 'zabbix apt sources list':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; path =&gt; "/etc/apt/sources.list.d/$zabbix_apt_file",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; absent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; present,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mode&nbsp;&nbsp; =&gt; '0644',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content =&gt; "$zabbix_apt_mirror\n",
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; exec { 'zabbix apt repository key':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; command =&gt; "wget $zabbix_apt_key_url -O- | apt-key add -",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; path =&gt; ['/bin', '/usr/bin', '/usr/sbin'],

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # see if "Zabbix" is in key list already, negate result
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unless =&gt; [ "apt-key list | grep $zabbix_apt_key_id -q" ],

&nbsp;&nbsp;&nbsp; }
}</pre>
<h2>Dateien</h2>
<p>Datei erstellen / entfernen</p>
<pre>file{'sqladm config file':
 &nbsp;&nbsp; path =&gt; $sqladm_cfg,
 &nbsp;&nbsp; ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; absent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; file,
&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp; owner =&gt; root,
&nbsp;&nbsp;&nbsp; group =&gt; root,
&nbsp;&nbsp;&nbsp; mode =&gt; 0444,
}
</pre>
<p>Link erzeugen&nbsp;/ entfernen</p>
<pre>file{ '/etc/apache2/conf.d/phpmyadmin.conf' :
&nbsp;&nbsp;&nbsp;&nbsp;target =&gt; '/etc/phpmyadmin/apache.conf',
&nbsp;&nbsp;&nbsp;&nbsp;ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; absent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; link,
&nbsp;&nbsp;&nbsp; },
}</pre>
<p>Verzeichnis anlegen, rekursiv kopieren / entfernen</p>
<pre>file { 'ssl files':
&nbsp;&nbsp;&nbsp; path =&gt; "$ssl_dir/$common_name",
&nbsp;&nbsp;&nbsp; ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; absent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; directory,
&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp; recurse =&gt; true,
&nbsp;&nbsp;&nbsp; force =&gt; true, # make ensure =&gt; absent works
&nbsp;&nbsp;&nbsp; mode&nbsp;&nbsp;&nbsp; =&gt; '0644',
&nbsp;&nbsp;&nbsp; source =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false =&gt; undef, # make ensure =&gt; absent works
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; "puppet:///modules/ssl/$common_name",
&nbsp;&nbsp;&nbsp; },
}
</pre>
<p>Verzeichnis rekursiv entfernen</p>
<pre>file { '/var/log/zabbix-agent':
&nbsp;&nbsp;&nbsp; ensure =&gt; absent,
&nbsp;&nbsp;&nbsp; force =&gt; true,
&nbsp;&nbsp;&nbsp; recurse =&gt; true,
}</pre>
<p>DIFF, PATCH und Neustarten von Diensten</p>
<p>&nbsp; Schwierig: der Patch verändert die zu überwachende Datei selbst und das Patchen würde ein weiteres Mal angestossen werden. Unterbunden durch <code>unless</code>&nbsp;Kondition (siehe Code).&nbsp;</p>
<p>&nbsp;</p>
<pre># file to be patched
$patch_target&nbsp; = '/usr/share/zabbix/include/blocks.inc.php'
# file containing patch data
# generate patch file like "diff-aur &lt;orig&nbsp; file&gt; &lt;file with changes&gt;"
$patch_source&nbsp; = '/usr/share/zabbix/include/blocks.inc.php.patch'
# command to check if patch has been applied, already
$check_cmd&nbsp; = "/usr/bin/patch -Rl -p1 --dry-run --force $patch_target &lt; $patch_source"
# command to apply patch
$patch_cmd&nbsp; = "/usr/bin/patch -NlbV numbered -p1 $patch_target &lt; $patch_source"
# command to reload service
$reload_cmd = '/usr/sbin/apachectl graceful'

# watch target file - changed by zabbix frontend package update?
file {'frontend dashboard php file':
&nbsp;&nbsp;&nbsp; path&nbsp;&nbsp; =&gt; "$patch_dir/$patch_target",
&nbsp;&nbsp;&nbsp; audit =&gt; content,
}

# copy patch file to server
file {'frontend dashboard patch':
&nbsp;&nbsp;&nbsp; path&nbsp;&nbsp; =&gt; $patch_source,
&nbsp;&nbsp;&nbsp; source =&gt; 'puppet:///modules/zabbix/frontend/blocks.inc-dashboard.patch',
}

# apply patch
exec {'apply frontend dashboard patch':
&nbsp;&nbsp;&nbsp; command =&gt; "$patch_cmd &amp;&amp; $reload_cmd"&nbsp; ,
&nbsp;&nbsp;&nbsp; unless&nbsp; =&gt; "$check_cmd",
&nbsp;&nbsp;&nbsp; refreshonly =&gt; true, # run only when triggered by notify
&nbsp;&nbsp;&nbsp; require =&gt; Package['patch'],
&nbsp;&nbsp;&nbsp; subscribe =&gt; File['frontend dashboard patch','frontend dashboard php file'],
}</pre>
<h2>OS</h2>
<p>Switch Anweisung entsprechend OS:</p>
<pre>notify { "Mac warning":
&nbsp;&nbsp;&nbsp;&nbsp;message =&gt; $operatingsystem ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Darwin' =&gt; "This seems to be a Mac.",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default =&gt; "And I’m a PC.",
&nbsp;&nbsp;&nbsp;},
}</pre>
<h2>Sammlung</h2>
<pre>Exec {
path =&gt; [
'/usr/local/bin',
'/opt/local/bin',
'/usr/bin',
'/usr/sbin',
'/bin',
'/sbin'],
logoutput =&gt; true,
}
exec {'pwd':}
exec {'whoami':}


## style hints
We recommend using single quotes for all strings that do not require variable interpolation. Use double quotes for those strings that require variable interpolation.

Code in those external manifests should always be stored in a class or defined resource type, or else it will be imported into the main scope and applied to all nodes.




&nbsp;&nbsp;&nbsp; ## variables
&nbsp;&nbsp;&nbsp; $content = 'some content\n'
&nbsp;&nbsp;&nbsp; file { '/tmp/testing': content =&gt; $content }

&nbsp;&nbsp;&nbsp; # a variable may only be assigned/changed once per scope

&nbsp;&nbsp;&nbsp; # reference to variables
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class myclass {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $test = 'content'
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class anotherclass {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $other = $myclass::test
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }



&nbsp;&nbsp;&nbsp; ## arrays

&nbsp;&nbsp;&nbsp; # TEMPLATES
&nbsp;&nbsp;&nbsp; # ----------- print array members as space-separated string
&nbsp;&nbsp;&nbsp; ip=&lt;%= ips_public.flatten.join(' ') %&gt;'

&nbsp;&nbsp;&nbsp; # ------------ iterate over array
&nbsp;&nbsp;&nbsp; &lt;% hc_hosts.each do |hc_host| -%&gt;
&nbsp;&nbsp;&nbsp; &lt;%=&nbsp; hc_host %&gt;.&lt;%= hc_domain %&gt;&nbsp;&nbsp;&nbsp; &lt;%= hc_host -%&gt;
&nbsp;&nbsp;&nbsp; &lt;% end -%&gt;

&nbsp;&nbsp;&nbsp; # ----------- iterate over associative array
&nbsp;&nbsp;&nbsp; # !!! There is no comma after last element of hash

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # host cluster members
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $hc_hosts = {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; host1 =&gt; "$dmz.$id_host1",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; host2 =&gt; "$dmz.$id_host2"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; &lt;% hc_hosts.each _pair do |hc_host, hc_host_ip | -%&gt;
&nbsp;&nbsp;&nbsp; &lt;%= hc_host_ip %&gt;&nbsp;&nbsp; &lt;%=&nbsp; hc_host %&gt;.&lt;%= hc_domain %&gt;&nbsp;&nbsp;&nbsp; &lt;%= hc_host -%&gt;
&nbsp;&nbsp;&nbsp; &lt;% end -%&gt;



&nbsp;&nbsp;&nbsp; # PUPPET SCRIPTS


&nbsp;&nbsp;&nbsp; # --------- sample usage

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; define php::pear() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; package { "php-${name}": ensure =&gt; installed }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; php::pear { ['ldap', 'mysql', 'ps', 'snmp', 'sqlite', 'tidy', 'xmlrpc']: }



&nbsp;&nbsp;&nbsp; # ---------- appending to arrays !! scope is local to test, only!
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ssh_users = [ 'myself', 'someone' ]

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class test {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ssh_users += ['someone_else']
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; # ---------- iterate over array
&nbsp;&nbsp;&nbsp; if&nbsp; you have an array like:
&nbsp;&nbsp;&nbsp; $array=[ "entry1", "entry2" ]

&nbsp;&nbsp;&nbsp; you can use it like:

&nbsp;&nbsp;&nbsp; define dosomething {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # you will have your array element available here as $name
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; # use the define with your array
&nbsp;&nbsp;&nbsp; dosomething { $array }
&nbsp;&nbsp;&nbsp; #----------


&nbsp;&nbsp;&nbsp; $a = [ 'one', 'two', 'three' ]
&nbsp;&nbsp;&nbsp; notice $a[1] # would return two



&nbsp;&nbsp;&nbsp; array of resource references [ Notify['look'], Notify['like'], Notify['this'] ]

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file { [ 'foo', 'bar', 'foobar' ]: # see class inheritance below
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; owner =&gt; root,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; group =&gt; root,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mode&nbsp; =&gt; 600,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # call a custom defined resource multiple times
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; define php::pear() {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; package { "`php-${name}": ensure =&gt; installed }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; php::pear { ['ldap', 'mysql', 'ps', 'snmp', 'sqlite', 'tidy', 'xmlrpc']: }

&nbsp;&nbsp;&nbsp; ## hashes
&nbsp;&nbsp;&nbsp; $myhash = { key1 =&gt; "myval", key2 =&gt; $b }

&nbsp;&nbsp;&nbsp; # And to access hash members (recursively) from a variable containing a hash (this also works for arrays too):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $myhash = { key =&gt; { subkey =&gt; "b" }}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notice($myhash[key][subkey]]
&nbsp;&nbsp;&nbsp; # You can also use a hash member as a resource title, as a default definition parameter, or potentially as the value of a resource parameter


&nbsp;&nbsp;&nbsp; ## conditions
&nbsp;&nbsp;&nbsp; # "in"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $value = 'beat generation'
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if 'eat' in $value {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notice("on the road")
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; # selector: returns value
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file { '/etc/config':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; owner =&gt; $operatingsystem ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'sunos'&nbsp;&nbsp; =&gt; 'adm',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'redhat'&nbsp; =&gt; 'bin',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default&nbsp;&nbsp; =&gt; undef,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # or
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $owner = $operatingsystem ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sunos&nbsp;&nbsp; =&gt; 'adm',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /(redhat|debian)/&nbsp; =&gt; "$1",&nbsp; # $1 = redhat or debian
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; undef,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $virtarg = $paravirt ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true =&gt; '--paravirt',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false =&gt; '--hvm',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; # case: does not return value
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case $operatingsystem {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sunos,debian:&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include solaris
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include debian
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /^(r|f)edhat$/:&nbsp; { notice{"Welcome $1!" }&nbsp; } # apply the redhat class
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default: { include generic } # apply the generic class
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; # if then
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if $server == 'mongrel' {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include mongrel
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } elsif $server == 'nginx' {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include nginx
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include thin
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ( $processor_count &gt; 2 ) and (( $ram &gt;= 16 * $gigabyte ) or ( $disksize &gt; 1000 )) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include for_big_irons
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include for_small_box
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; and, or and not, group by()
&nbsp;&nbsp;&nbsp; ==, !=, &lt;, &gt;, &lt;=, &gt;, &gt;=
&nbsp;&nbsp;&nbsp; +, -, /, *, &lt;&lt;, &gt;&gt;
&nbsp;&nbsp;&nbsp; =~ and !~ # regexp
&nbsp;&nbsp;&nbsp; # bool example
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $one = 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $two = 2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $var = ( $one &lt; $two ) and ( $one + 1 == $two )
&nbsp;&nbsp;&nbsp; # regexp example
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if $host =~ /^www(\d+)\./ {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notice('Welcome web server #$1')&nbsp; # $1 = number following www
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }



&nbsp;&nbsp;&nbsp; ## virtual ressources
&nbsp;&nbsp;&nbsp; Virtual resources are resources that are not sent to the client unless realized

&nbsp;&nbsp;&nbsp; @user { luke: ensure =&gt; present } # defined virtually
&nbsp;&nbsp;&nbsp; realize User[luke]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # relaized a): the user whose title is luke
&nbsp;&nbsp;&nbsp; User &lt;| title == luke |&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # relaized b): the user whose title is luke

&nbsp;&nbsp;&nbsp; # exporting ressources, tags
&nbsp;&nbsp;&nbsp; # see http://docs.puppetlabs.com/guides/exported_resources.html
&nbsp;&nbsp;&nbsp; node a {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @@file { "/tmp/foo": content =&gt; "fjskfjs\n", tag =&gt; "foofile", }
&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; node b {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File &lt;&lt;| tag == 'foofile' |&gt;&gt;
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; # debugging

&nbsp;&nbsp;&nbsp; log to master log:
&nbsp;&nbsp;&nbsp; notice("The value is: ${yourvar}")


&nbsp;&nbsp;&nbsp; log to agent's syslog:
&nbsp;&nbsp;&nbsp; notify{"The value is: ${yourvar}": }


&nbsp;&nbsp;&nbsp; puppetd --test --environment=development --debug | tee /tmp/puppet-debug.log
&nbsp;&nbsp;&nbsp; less /tmp/puppet-debug.log


&nbsp;&nbsp;&nbsp; # module import
&nbsp;&nbsp;&nbsp; include foo::bar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # {modulepath}/foo/manifests/bar.pp&nbsp; class foo::bar
&nbsp;&nbsp;&nbsp; class { "foo::bar::awesome": } # {modulepath}/foo/manifests/bar/awesome.pp class foo::bar::awesome { ... }


&nbsp;&nbsp;&nbsp; # Run a Command Whenever A File Changes
&nbsp;&nbsp;&nbsp; file { "/etc/bind": source =&gt; "/dist/apps/bind" }


&nbsp;&nbsp;&nbsp; exec { '/usr/bin/ndc reload':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subscribe =&gt; File['/etc/bind'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; refreshonly =&gt; true,
&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; # class parameters

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; node webserver {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class { apache: version =&gt; "1.3.13" }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class apache($version="1.3.13",$home="/var/www") {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... class contents ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; ## class inheritance/ vererbung
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class unix {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file { '/etc/passwd':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; owner =&gt; 'root',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; group =&gt; 'root',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mode&nbsp; =&gt; 644;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; class freebsd inherits unix {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File['/etc/passwd'] { group =&gt; wheel }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; # undo i
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class apache($version) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... class contents ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; node webserver {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class { apache: version =&gt; "1.3.13" }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # default parameters
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class apache($version="1.3.13",$home="/var/www") {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... class contents ...
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; ## if else
&nbsp;&nbsp;&nbsp; if ($icinga::bool_enable_icingaweb == true and $icinga::bool_enable_idoutils == true) {
&nbsp;&nbsp;&nbsp;&nbsp; ...
&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; ## regexps, nodes
&nbsp;&nbsp;&nbsp; node /^(foo|bar)\.testing\.com$/ {
&nbsp;&nbsp;&nbsp; node 'www.testing.com', 'www2.testing.com', 'www3.testing.com' {

&nbsp;&nbsp;&nbsp; ## regexp, slector
&nbsp;&nbsp;&nbsp; $owner = $operatingsystem ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /(redhat|debian)/&nbsp; =&gt; 'bin',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; undev
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; ## package relation ships, notifying
&nbsp;&nbsp;&nbsp; File["/etc/ntp.conf"] ~&gt; Service[ntpd]
&nbsp;&nbsp;&nbsp; # This manages the ntp configuration file before the ntpd service and notifies the service of changes to the ntp configuration file.



&nbsp;&nbsp;&nbsp; ## package/file/service pattern
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # /root/learning-manifests/break_ssh.pp
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; package { 'openssh-server':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; present,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; before =&gt; File['/etc/ssh/sshd_config'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file { '/etc/ssh/sshd_config':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; file,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mode&nbsp;&nbsp; =&gt; 600,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source =&gt; '/root/learning-manifests/sshd_config',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; service { 'sshd':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure&nbsp;&nbsp;&nbsp;&nbsp; =&gt; running,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enable&nbsp;&nbsp;&nbsp;&nbsp; =&gt; true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hasrestart =&gt; true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hasstatus&nbsp; =&gt; true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subscribe&nbsp; =&gt; File['/etc/ssh/sshd_config'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; # defines
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; define testy ($tex) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; notify { $tex: }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; testy { "test" : tex =&gt; "hallo" }


&nbsp;&nbsp;&nbsp; FEHLER

&nbsp;&nbsp;&nbsp; Error 400 on SERVER: undefined method `safeevaluate' for nil:NilClass
&nbsp;&nbsp;&nbsp; passiert wenn eine define anweisung innerhalb einer case loop kommt, ohne case loop gehts und wenn die define anweisung innerhalb einer class gekapselt wird auch


&nbsp;&nbsp;&nbsp; # enable boot logger bootlogd
&nbsp;&nbsp;&nbsp; cat &lt;&lt; BOOT_LOG_END &gt; /etc/default/bootlogd || die
&nbsp;&nbsp;&nbsp; # Run bootlogd at startup ?
&nbsp;&nbsp;&nbsp; BOOTLOGD_ENABLE=Yes
&nbsp;&nbsp;&nbsp; BOOT_LOG_END


&nbsp;&nbsp;&nbsp; # file system permissions
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo " * file system permissions ... "
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; install -d $TargetDir/tmp&nbsp;&nbsp;&nbsp;&nbsp; --mode 1777
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; install -d $TargetDir/var/tmp --mode 1777
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; install -d $TargetDir/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --mode 0755
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; install -d $TargetDir/etc&nbsp;&nbsp;&nbsp;&nbsp; --mode 0755
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; install -d $TargetDir/var/log --mode 0755
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; install -d $TargetDir/root&nbsp;&nbsp;&nbsp; --mode 0750
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; install -d $TargetDir/boot&nbsp;&nbsp;&nbsp; --mode 0750
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chmod 0440 $TargetDir/etc/sudoers
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chmod 0644 $TargetDir/etc/passwd&nbsp;&nbsp;&nbsp; $TargetDir/etc/group&nbsp; $TargetDir/etc/profile
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chmod 0600 $TargetDir/etc/passwd-&nbsp;&nbsp; $TargetDir/etc/group- $TargetDir/etc/shadow
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chmod 0600 $TargetDir/etc/securetty $TargetDir/etc/shadow-


&nbsp;&nbsp;&nbsp; # set up production state flag (productive/test/other system)
&nbsp;&nbsp;&nbsp; $TargetDir/etc/prod_system
&nbsp;&nbsp;&nbsp; $TargetDir/etc/test_system
&nbsp;&nbsp;&nbsp; $TargetDir/etc/test_system


&nbsp;&nbsp;&nbsp; # define stuff
&nbsp;&nbsp;&nbsp; define add_user ( $email, $uid ) {

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $username = $title
&nbsp;&nbsp;&nbsp; ...
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add_user { rrunner:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; email&nbsp;&nbsp;&nbsp; =&gt; "road.runner@acme.com",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; 5001
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }



&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # edit single line in file (add line if not exists)
&nbsp;&nbsp;&nbsp; # see http://projects.puppetlabs.com/projects/1/wiki/Simple_Text_Patterns

&nbsp;&nbsp;&nbsp; define line($file, $line, $ensure = 'present') {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case $ensure {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default : { err ( "unknown ensure value ${ensure}" ) }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; present: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exec { "/bin/echo '${line}' &gt;&gt; '${file}'":
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unless =&gt; "/bin/grep -qFx '${line}' '${file}'"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; absent: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exec { "/bin/grep -vFx '${line}' '${file}' | /usr/bin/tee '${file}' &gt; /dev/null 2&gt;&amp;1":
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onlyif =&gt; "/bin/grep -qFx '${line}' '${file}'"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Use this resource instead if your platform's grep doesn't support -vFx;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # note that this command has been known to have problems with lines containing quotes.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # exec { "/usr/bin/perl -ni -e 'print unless /\Q${line}\\E\$/' '${file}'":
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #&nbsp;&nbsp;&nbsp;&nbsp; onlyif =&gt; "/bin/grep -qFx '${line}' '${file}'"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; }


&nbsp;&nbsp;&nbsp; # comment a line in file
&nbsp;&nbsp;&nbsp; uncomment: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exec { "/bin/sed -i -e'/${line}/s/#\+//' ‘${file}’” :
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onlyif =&gt; "/bin/grep '${line}' '${file}' | /bin/grep '^#' | /usr/bin/wc -l"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; comment: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exec { "/bin/sed -i -e'/${line}/s/\(.\+\)$/#\1/' ‘${file}’" :
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onlyif =&gt; "/usr/bin/test `/bin/grep '${line}' '${file}' | /bin/grep -v '^#' | /usr/bin/wc -l` -ne 0"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; # Usage example (activate logsentry with vixie-cron):
&nbsp;&nbsp;&nbsp; line { "logsentrycron":
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file =&gt; "/etc/cron.hourly/logsentry.cron",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; line =&gt; "logcheck.sh",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; uncomment
&nbsp;&nbsp;&nbsp; }</pre>
<p>&nbsp;</p>


<p>&nbsp;</p>
<div class="errormsg systemmsg" id="sessionMsg">
	<div class="inner">
		<ul class="flashMsg">
			<li>Diese Seite muss komplett üerbarbeitet werden, Vorlage: <a href="mks://localhost/Abteilungen/Entwicklung/Executive/Tools/Windows/Powershell/Programmierung" title="Abteilungen/Entwicklung/Executive/Tools/Windows/Powershell/Programmierung%2C_Skripte">Powershell Programmierung</a></li>
		</ul>
	</div>
</div>
<h2>Inhaltsverzeichnis</h2>
<p>{{ page.toc }}</p>
<h2>Einleitung</h2>
<p>Diese Seite gibt Hilfestellung für das Schreiben von Puppet Manifests.&nbsp;</p>
<h2>Formatierungen, Design Guide</h2>
<p>Kommentare</p>
<pre>class ssl::apache(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Boolean $enable = true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String $apache_confdir&nbsp;&nbsp;&nbsp;&nbsp; = $ssl::params::apache_confdir,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String $apache_conflinkdir = $ssl::params::apache_conflinkdir,
&nbsp;&nbsp;&nbsp; ) inherits ssl::params {
&nbsp;&nbsp;&nbsp; /*//////////////////////////////////////////////////////////////////////
&nbsp;&nbsp;&nbsp; SYNOPSIS
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Install ssl config and ssl macro for virtual hosts to apache

&nbsp;&nbsp;&nbsp; DESCRIPTION
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Install ssl config and ssl macro for virtual hosts to apache
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Restarting apache service is not done automatically, this would
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; need extra apache module in puppet

&nbsp;&nbsp;&nbsp; EXAMPLE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include ssl::apache
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class {'ssl::apache': enable =&gt; false&nbsp; }

&nbsp;&nbsp;&nbsp; PARAMETER enable
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * true: install files
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * false: remove links and config files
&nbsp;&nbsp;&nbsp; //////////////////////////////////////////////////////////////////////*/
&nbsp;&nbsp;&nbsp;&nbsp;...
}</pre>
<h2>Strukturen</h2>
<h3>Einfach</h3>
<h3>Komplex</h3>
<h4>Klassen und Ressourcen</h4>
<p>Klassen und Aufruf von Klassen (dürfen mehrfach aufgerufen werden, sollten dann aber immer für den gleichen Zweck verwendet werden). Siehe auch&nbsp;<span style="line-height: 1.5;">Klassen, Default Parameter, Vererbung.</span></p>
<pre># Definition:
    class ssl::install_key( Boolean $enable=true,) 
&nbsp;&nbsp;&nbsp;     file { 'ssl files':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     path =&gt; 'examplepath',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     ensure =&gt; present,
&nbsp;&nbsp;&nbsp;&nbsp;    }
    }
# Aufruf ohne Parameter
&nbsp;&nbsp;&nbsp; include ssl::install_key  
# Aufruf mit Parametern
&nbsp;&nbsp;&nbsp; class {'ssl::install_key': enable =&gt; false }</pre>
<p>Ressourcen (dürfen nur einmalig definiert werden, verwendbar für mehrere Installationen gleicher Art (apache virtual hosts, ssl dateien, drbd resourcen etc).&nbsp;</p>
<pre># Definition:
class ssl {
&nbsp;&nbsp;&nbsp;&nbsp;define install_key( Boolean $enable=true) {
    &nbsp;&nbsp;&nbsp; file { 'test file':
&nbsp;&nbsp;&nbsp;&nbsp;    &nbsp;&nbsp;&nbsp; path =&gt; $name,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     ensure =&gt; present,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;}
}
# Aufruf mit Parametern (hier als name und enabled-parameter)
&nbsp;&nbsp;&nbsp;&nbsp;ssl::install_key{'/tmp/testfile': }</pre>
<p>Klassen, Default Parameter, Vererbung:&nbsp;Siehe <a class="external" href="https://docs.puppetlabs.com/puppet/latest/reference/lang_classes.html#using-resource-like-declarations" style="font-size: 12px; line-height: 1.5;" title="https://docs.puppetlabs.com/puppet/latest/reference/lang_classes.html#using-resource-like-declarations">Offizielle Puppet Doku</a>&nbsp; und "<span style="line-height: 1.5;">It is especially useful when you want your default values to change based on system facts and other data, since it lets you isolate and encapsulate all that conditional logic."</span></p>
<pre># modules/ssl/manifests/init.pp

class ssl::params {
&nbsp;&nbsp;&nbsp; $apache_confdir = $lsbdistcodename ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'lucid' =&gt; '/etc/apache2/conf.d',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; '/etc/apache2/conf-available',
&nbsp;&nbsp;&nbsp; }

&nbsp;&nbsp;&nbsp; $apache_conflinkdir = $lsbdistcodename ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'lucid' =&gt; 'NONE',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; '/etc/apache2/conf-enabled',
&nbsp;&nbsp;&nbsp; }
}

# Definition einer Klasse
class ssl::apache(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Boolean $enable = true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String $apache_confdir&nbsp;&nbsp;&nbsp;&nbsp; = $ssl::params::apache_confdir,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String $apache_conflinkdir = $ssl::params::apache_conflinkdir,
&nbsp;&nbsp;&nbsp; ) inherits ssl::params {
&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; case $apache_conflinkdir {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'NONE': {}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default: {

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file { 'ssl macro enabled link':
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; path&nbsp;&nbsp; =&gt; "$apache_conflinkdir/ssl.conf",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; target =&gt; "$apache_confdir/ssl.conf",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; absent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; link,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; require =&gt; File['ssl macro definition'],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; }
}

# Definition einer Ressource, Anwendung wie : 
# &nbsp;  class {'ssl::key': ssl_dir =&gt; '/tmp/dd' }  # optionales Überschreiben der default-Werte
#    ssl::key::install{'%.fellowtech.de': enable =&gt; true }
# wird class('ssl' ...) nicht definiert, werden die default Werte aus ssl::params verwendet.

class ssl::key (
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String $ssl_dir = $ssl::params::ssl_dir,
&nbsp;&nbsp;&nbsp; ) inherits ssl::params { 
&nbsp;&nbsp;&nbsp;&nbsp;/*/////////////////////////////////////////////////////////////////////////
&nbsp;&nbsp;&nbsp;&nbsp;Prepare environment for "install_key" ressources, override at "install_key"
&nbsp;&nbsp;&nbsp;&nbsp;invocation like 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class {'ssl': ssl_dir =&gt; '/tmp/dd' }
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssl::key::install{'%.fellowtech.de': enable =&gt; true }
&nbsp;&nbsp;&nbsp;&nbsp;/////////////////////////////////////////////////////////////////////////*/
}

file{
}

define ssl::key::install( Boolean $enable=true&nbsp; ) {
&nbsp;&nbsp;&nbsp; /*////////////////////////////////////////////////////////////////////////
&nbsp;&nbsp;&nbsp; SYNOPSIS
&nbsp;&nbsp;&nbsp; DESCRIPTION
&nbsp;&nbsp;&nbsp; EXAMPLE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include zabbix::frontend::setup
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class{'zabbix::frontend::setup': enable =&gt; false,}
&nbsp;&nbsp;&nbsp; PARAMETER enable
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * true: install files
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * false: links and config files
&nbsp;&nbsp;&nbsp; ////////////////////////////////////////////////////////////////////////*/
&nbsp;&nbsp;&nbsp; include ssl # load defaults from ssl::params (indirectly)

&nbsp;&nbsp;&nbsp;&nbsp;# all definitions here must be unique to ressource $name
&nbsp;&nbsp;&nbsp; file { "$name ssl files":
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; path =&gt; "$ssl::ssl_dir/$name",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ensure =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false&nbsp;&nbsp; =&gt; absent,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; directory,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recurse =&gt; true,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; force =&gt; true, # make ensure =&gt; absent work
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mode&nbsp;&nbsp;&nbsp; =&gt; '0644',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source =&gt; $enable ? {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; false =&gt; undef,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default =&gt; "puppet:///modules/ssl/$name",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },
&nbsp;&nbsp;&nbsp; }
}

</pre>
<p>&nbsp;</p>

</body>
</html>